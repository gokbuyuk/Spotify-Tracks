---
title: "S632 - Final Project - Spotify Tracks"
author: "Adnan Cihan Cakar, Gokcen Buyukbas"
date: "4/9/2021"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo=TRUE,
               cache=TRUE, autodep=TRUE, cache.comments=FALSE,
               message=FALSE, warning=FALSE)
library(faraway)
library(lme4)
library(RLRsim)
library(ggplot2)
library(boot)
library(tidyverse)
library(pbkrtest)
library(viridis)
library(devtools)
library(ggbiplot)
```

# Data Import

```{r}
tracks = read.csv("C:/Users/Gokcen/Desktop/Github/Spotify-Tracks/tracks.csv")
```

```{r}
# tracks = read.csv("C:/Users/Gokcen/Desktop/Github/Spotify-Tracks/spofity/data.csv")
# year_cut = 2015
# tracks = tracks[tracks$year>2015,]
# 
# tracks = subset(tracks, select=-c(id,artists,name))
# 
# tracks$release_date = as.Date(tracks$release_date)
# 
# getSeason <- function(date) {
#     WS <- as.Date("2012-12-15", format = "%Y-%m-%d") # Winter Solstice
#     SE <- as.Date("2012-3-15",  format = "%Y-%m-%d") # Spring Equinox
#     SS <- as.Date("2012-6-15",  format = "%Y-%m-%d") # Summer Solstice
#     FE <- as.Date("2012-9-15",  format = "%Y-%m-%d") # Fall Equinox
# 
#     # Convert dates from any year to 2012 dates
#     d <- as.Date(strftime(date, format="2012-%m-%d"))
# 
#     ifelse (d >= WS | d < SE, "Winter",
#       ifelse (d >= SE & d < SS, "Spring",
#         ifelse (d >= SS & d < FE, "Summer", "Fall")))
# }
# tracks$season = apply(as.data.frame(tracks$release_date), 1, getSeason)
# tracks$season = as.factor(tracks$season)
# tracks$year = as.factor(tracks$year)
# tracks$key = as.factor(tracks$key)
# tracks$explicit = as.factor(tracks$explicit)
# tracks$mode = as.factor(tracks$mode)
# tracks$explicit = as.factor(tracks$explicit)
# tracksnum$duration_ms = tracksnum$duration_ms/1000
# 
# write.csv(tracks,'tracks.csv', row.names = FALSE)
```


```{r}
str(tracks)
summary(tracks)
#model = glm(cbind(popularity, 100-popularity) ~ ., family = binomial, tracks)
```


### Variables:


### Plan:
1. Model selection, variable selection



### Reasearch Question: 
What features of songs play a role in a song's popularity?

### Description of the data

Primary:
- id (Id of track generated by Spotify)

Numerical:
- acousticness (Ranges from 0 to 1)
- danceability (Ranges from 0 to 1)
- energy (Ranges from 0 to 1)
- duration_ms (Integer typically ranging from 200k to 300k)
- instrumentalness (Ranges from 0 to 1)
- valence (Ranges from 0 to 1)
- popularity (Ranges from 0 to 100)
- tempo (Float typically ranging from 50 to 150)
- liveness (Ranges from 0 to 1)
- loudness (Float typically ranging from -60 to 0)
- speechiness (Ranges from 0 to 1)
- year (Ranges from 1921 to 2020)

Dummy:
- mode (0 = Minor, 1 = Major)
- explicit (0 = No explicit content, 1 = Explicit content)

Categorical:
- key (All keys on octave encoded as values ranging from 0 to 11, starting on C as 0, C# as 1 and so onâ€¦)
- artists (List of artists mentioned)
- release_date (Date of release mostly in yyyy-mm-dd format, however precision of date may vary)
- name (Name of the song)


### Data processing:
- Removed the id, artists and name of tracks
- Converted the categorical variables to factor

```{r}
ggplot(tracks, aes(x=danceability, y=popularity, color=key, shape=explicit))+geom_point(position = position_jitterdodge(jitter.width=0.05))+ 
scale_color_viridis(option="magma")
```


```{r}
ggplot(tracks, aes(x=(tempo) , y=popularity, color=energy, shape=mode))+geom_point(alpha = 0.5) + 
scale_color_viridis(option="magma")
```

```{r}
tracksnum = subset(tracks, select=-c(popularity, mode, explicit, year, season, key, release_date ))
pca = prcomp(tracksnum, scale. = TRUE)

```

```{r}
ggbiplot(pca, var.axes=FALSE) + geom_point(aes(color=tracksnum$popularity)) + scale_color_viridis(option="magma")
```

